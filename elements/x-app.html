<dom-module id="x-app">

    <!-- ----------------------------------------------------------------------------------------------------------- -->
    <!-- CSS -->
    <style>

        /* -------------------------------------------------- */
        /* SECTION: Generator */
        section#generator {
            margin: auto;
            max-width: 320px;
        }

        /* Checkbox */
        section#generator div.checkbox {
            margin: 30px 0 35px 0;
        }
        section#generator div.checkbox div.description {
            color: #999;
            margin: 10px 0 0 31px;
        }

        /* Buttons */
        section#generator div.buttons {
            padding: 0 2px;
        }
        section#generator div.buttons paper-button {
            background: white;
        }
        section#generator div.buttons paper-button.primary {
            background: #1E86BD;
            color: white;
        }

        /* -------------------------------------------------- */
        /* SECTION: About */
        section#about {
            line-height: 1.6em;
            margin: auto;
            max-width: 768px;
        }

        /* Horizontal line */
        section#about hr {
            border: none;
            border-top: 1px solid #CCC;
            margin: 30px 0;
            padding: 0;
        }

        /* Block */
        section#about div.block {
            margin: 20px 0;
            padding: 0 20px 0 20px;
        }
        section#about div.block.justify {
            text-align: justify;
        }

        /* List */
        section#about div.block ul {
            margin-bottom: 0;
        }

        /* Heading 2 */
        section#about div.block h2 {
            margin: 0 0 20px 0;
            padding: 0;
        }

        /* Blockquote */
        section#about div.block blockquote {
            border-left: 10px solid #E5E5E5;
            color: #999;
            font-size: .8em;
            margin: 0;
            padding: 0 0 0 10px;
        }
        section#about div.block blockquote span {
            color: #444;
        }

        /* Link */
        section#about div.block a {
            color: #555;
        }
        section#about div.block a:hover {
            text-decoration: none;
        }

        /* Image */
        section#about div.block img {
            display: block;
            margin: 30px auto 10px auto;
            max-width: 100%;
        }

        /* -------------------------------------------------- */
        /* Paper-dialogs */
        paper-dialog {
            background: white;
            max-width: 480px;
        }
        paper-dialog#saveWarningDialog paper-button {
            color: red;
        }
        paper-dialog#passwordDialog div#password {
            background: #E5E5E5;
            border: 1px solid #CCC;
            margin: 0 0 10px 0;
            overflow: auto;
            padding: 10px 20px;
            text-align: center;
        }

    </style>

    <!-- ----------------------------------------------------------------------------------------------------------- -->
    <!-- HTML -->
    <template>

        <!-- ------------------------------------------- -->
        <!-- Main content switcher -->
        <neon-animated-pages id="pages" selected="{{__page}}" entry-animation="fade-in-animation" exit-animation="fade-out-animation">

            <!-- Generator -->
            <section id="generator">

                <!-- Inputs -->
                <div>
                    <paper-input id="alias" type="input" value="{{alias}}" label="Alias" on-keyup="_onKeyupHandler"></paper-input>
                    <paper-input id="secret" type="password" value="{{secret}}" label="Secret" on-keyup="_onKeyupHandler"></paper-input>
                </div>

                <!-- Checkbox -->
                <div class="checkbox">
                    <paper-checkbox checked="{{save}}" on-click="_saveClickHandler">Save secret</paper-checkbox>
                    <div class="description">
                        Saves secret into browser's localstorage memory.
                    </div>
                </div>

                <!-- Buttons -->
                <div class="buttons horizontal center-justified layout">
                    <paper-button on-click="_clearClickHandler" class="flex" raised>Clear</paper-button>
                    <paper-button on-click="_generateClickHandler" class="primary flex" raised>Generate</paper-button>
                </div>

            </section>

            <!-- About -->
            <section id="about">

                <!-- Features -->
                <div class="block">
                    <h2>Features:</h2>
                    <ul>
                        <li>
                            <strong>Secure</strong> - Everything is done inside your
                            browser, no data leave your device, either to our servers,
                            or anywhere else.
                        </li>
                        <li>
                            <strong>Easy to use</strong> - Well designed and polished UI
                            for both computers and mobile devices.
                        </li>
                        <li>
                            <strong>Helpful</strong> - No need to remember complicated
                            passwords.
                        </li>
                        <li>
                            <strong>Fast</strong> - Your password is generated instantly.
                        </li>
                    </ul>
                </div>

                <!-- Separator -->
                <hr>

                <!-- What -->
                <div class="block justify">
                    <h2>What does it do?</h2>
                    Generator helps you with the problem of creating and remembering unique
                    passwords for all the social networks, online services and websites you
                    need passwords for. With just the help of an easy to remember alias and
                    one passphrase, generator creates unique strong passwords for your
                    services.
                    <br>
                    <br>
                    <strong>And what if you forget the generated password?</strong> That's
                    the best part: <u>You don't even have to remember it!</u> Just come back
                    to the generator and type in your alias and secret, and generator's
                    algorithm generates the same password for you once again.
                </div>

                <!-- Separator -->
                <hr>

                <!-- How -->
                <div class="block justify">
                    <h2>How it works?</h2>
                    All you need to remember for a website is its <u>alias</u>, for example
                    its domain or service name (facebook for https://facebook.com, onedrive
                    for Microsoft's One Drive, etc..) and <strong>one</strong> strong secret
                    passphrase. Generator then combines your alias and secret to together
                    and generates a unique strong password for you. For the more tech-savvy
                    of you, this is the meta algorithm. You can even create your own version
                    of generator based on this algorithm:
                    <br>
                    <br>
                    <blockquote>
                        <span>String alias = ...;</span> // Get alias<br>
                        <span>String secret = ...;</span> // Get secret<br>
                        <span>String s = alias + secret;</span> // Simply join alias and secret into one string<br>
                        <span>String hash = hash('sha256',s);</span> // Generate hash of string s using SHA256 algorithm<br>
                        <span>String base = base64Encode(hash);</span> // Encode hash from previous step into base64 encoding<br>
                        <span>String password = base.substring(17,49);</span> // Take 32 characters from generated base64, starting with 18th character, all the way up to 48th
                    </blockquote>
                </div>

            <!-- Separator -->
                <hr>

                <!-- Author -->
                <div class="block">
                    <h2>App & developer:</h2>
                    <ul>
                        <li>
                            Version: <strong>3.0.0-RELEASE</strong>
                        </li>
                        <li>
                            Author: <a href="https://plus.google.com/+MichalSukup%C4%8D%C3%A1k">Michal Sukupčák</a>
                        </li>
                        <li>
                            Source download: <a href="https://github.com/Bloodspell/Password-Generator">Github repository</a>
                        </li>
                        <li>
                            License: <a href="http://creativecommons.org/licenses/by/4.0/legalcode">CC Attribution 4.0 International</a>
                        </li>
                    </ul>
                    <br>
                    Feel free to use, download, explore, modify or share any and all parts
                    of the source code.
                </div>

            </section>

        </neon-animated-pages>

        <!-- ------------------------------------------- -->
        <!-- Missing alias toast -->
        <paper-toast id="aliasMissingToast">Please fill in the Alias!</paper-toast>

        <!-- ------------------------------------------- -->
        <!-- Missing secret toast -->
        <paper-toast id="secretMissingToast">Please fill in the Secret!</paper-toast>

        <!-- ------------------------------------------- -->
        <!-- Save warning dialog -->
        <paper-dialog id="saveWarningDialog" modal>
            <h2>WARNING</h2>
            <div>
                Storing your secret in local storage means your secret may become visible to anyone with physical
                access to your computer! Please make sure you only keep this setting checked on your personal and
                secure computer. Using the Clear data button will remove this setting and saved secret from local
                storage.
            </div>
            <div class="buttons">
                <paper-button dialog-dismiss>I understand the risks</paper-button>
            </div>
        </paper-dialog>

        <!-- ------------------------------------------- -->
        <!-- Response dialog -->
        <paper-dialog id="passwordDialog" modal>
            <h2>Your password:</h2>
            <div>
                <div id="password">{{password}}</div>
                You can now select your password and copy it to your clipboard. Also, if you're on a publicly
                accessible computer, don't forget to clear the generator form before you leave the app!
            </div>
            <div class="buttons">
                <paper-button dialog-dismiss>Close</paper-button>
            </div>
        </paper-dialog>

        <!-- ------------------------------------------- -->
        <!-- Localstorage for secret -->
        <iron-localstorage name="secret" id="secretLocalstorage"
            value="{{secret}}"
            auto-save-disabled
        ></iron-localstorage>

        <!-- ------------------------------------------- -->
        <!-- Localstorage for save checkbox -->
        <iron-localstorage name="save" id="saveLocalstorage"
            value="{{save}}"
        ></iron-localstorage>

    </template>

    <!-- ----------------------------------------------------------------------------------------------------------- -->
    <!-- Javascript -->
    <script>
        Polymer({

            /* ------------------------------------------------------------------------------------------------------ */
            /* Init */

            /**
             * Element initialization and properties definition.
             */
            is: 'x-app',
            properties: {
                __page: {
                    type: Number,
                    value: 0,
                    notify: true
                },
                alias: {
                    type: String,
                    value: ''
                },
                secret: {
                    type: String,
                    value: ''
                },
                save: {
                    type: Boolean,
                    value: false
                },
                password: {
                    type: String,
                    value: ''
                }
            },

            /* ------------------------------------------------------------------------------------------------------ */
            /* Lifecycle callbacks */

            /**
             * Called when element is created.
             */
            created: function () {},

            /**
             * Called when element is attached to DOM.
             */
            attached: function () {
                this.$.alias.$.input.focus();
            },

            /**
             * Called when element is detached from DOM.
             */
            detached: function () {},

            /* ------------------------------------------------------------------------------------------------------ */
            /* Observers */

            // ...

            /* ------------------------------------------------------------------------------------------------------ */
            /* Event handlers */

            _onKeyupHandler: function (event) {
                var key = (typeof event.which === "number") ? event.which : event.keyCode;
                if (key == 13) {
                    this._generateClickHandler();
                }
            },

            /**
             * Opens warning dialog when user decides to check the "Save secret" checkbox.
             */
            _saveClickHandler: function () {
                console.log(this.save);
                if (this.save == true) {
                    this.$.saveWarningDialog.open();
                }
            },

            /**
             * Clears input fields.
             */
            _clearClickHandler: function () {
                this.alias = '';
                this.secret = '';
                this.save = false;
                this.password = '';
                this.$.secretLocalstorage.save();
            },

            _generateClickHandler: function () {
                if (this.alias == '') {
                    this.$.alias.$.input.focus();
                    this.$.aliasMissingToast.show();
                } else if (this.secret == '') {
                    this.$.secret.$.input.focus();
                    this.$.secretMissingToast.show();
                } else {
                    this.password = Base64.encode(Sha256.hash(this.alias + this.secret)).substring(17,49);
                    this.$.passwordDialog.open();
                    if (this.save == true) {
                        this.$.secretLocalstorage.save();
                    }
                }
            }

            /* ------------------------------------------------------------------------------------------------------ */
            /* Helper functions */

            // ...

        });
    </script>

</dom-module>